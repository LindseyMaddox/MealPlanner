<div class = "row">
  <div class="col-sm-3"></div>
  <div class="col-sm-6 heading">  
    <h4>This Week's Meal suggestions are:</h4>
  </div>
</div>
</br> 
<div class="row">
  <div class="col-sm-3"></div>
  <div class="col-sm-6">
    <div class="row">
      <div class="col-sm-5"><h5>Recipe</h5></div>
      <div class="col-sm-7"><h5>Date</h5></div>
    </div>
  </div>
</div>
<div class = "row">
  <div class="col-sm-3"></div>
  <div class="col-sm-6 meal-suggestions">
    <% @this_week_meals.each do |meal| %>
      <div class="row meal">
        <div class="col-sm-5">
           <%= link_to meal.name, recipe_path(meal.recipe_id) %>
        </div>
        <div class="col-sm-7">
           <%= text_field_tag(:meal, value = "Select Date", id: "meal-date" + meal.recipe_id.to_s, class: 'meal-date') %>
           <%=  hidden_field_tag(:recipe_id, meal.recipe_id, class: 'recipe-id') %>
           <%=  hidden_field_tag(:user_id, current_user.id, class: 'user-id') %>
        </div>
      </div>
    </br>
    <% end %>
  </div>
  <div class="col-sm-3">
    <div class="row">
       <div class="col-sm-12"> <strong>Number of Suggestions</strong></div>
          <div class="col-sm-12">
              <% @number_of_meals.each_pair do |text, number| %>
                <li>
                  <%= link_to "#{text}", planner_meals_path(number_of_meals: number), class: 'label label-primary' %>
                </li>
              <% end %>
          </div>
        </div>
    </div>
  </div>
</br>
</br>
<div class="row">
  <div class="col-sm-3"></div>
  <div class="col-sm-6">Filter by grain:</div>
</div>
<div class="row">
  <div class="col-sm-3"></div>
  <div class="col-sm-6">
     <% @grains.each do |grain| %>
      <% unless grain == @grains.last %>
       <%= link_to grain.name, planner_meals_path(grain_requests: grain.id) %>,
      <% else %>
        <%= link_to grain.name, planner_meals_path(grain_requests: grain.id) %>
      <% end %>
    <% end %>
  </div>
</div>
  <%# Need to figure out appropriate layout for this section %>
  <%#<div class="col-sm-3"><p>Summary: This week, you're making <% @difficult_items.length %><%#</div></p> %>

    <%# 
    It is impossible to have more than 3 items with a value of 2 or higher, so you only
    need 3 conditions. 
    
 %>
</br>
<div class="row">
  <div class="col-sm-4"></div>
  <div class="col-sm-3">
    <button class="btn btn-success save">
      Save Meal Plan
    </button>
  </div>
</div>
</br>
<script type="text/javascript">
$(function () {
$('.meal-date').datepicker({
  dateFormat: "yy-mm-dd"
});
 
    var saveButton = $('.save');


//currently basing date on tomorrow + 1 for each new recipe
   
   var date = new Date(Date.now());



    saveButton.on("click", function() {

var dataArr = []
 $('.meal').each(function(){
  var tempHash = {}
  //trying to traverse down so we can use the new styling
  //and put the new styling on angellist :)
  var mealDate = $(this).find(".meal-date").datepicker("getDate");
  var userID = $(this).find(".user-id").val();
  var recipeID = $(this).find(".recipe-id").val();

  tempHash["recipe_id"] = recipeID;
  tempHash["user_id"] = userID;
  tempHash["meal_date"] = mealDate;
dataArr.push(tempHash);
 });
 

      
      $.ajax({
             url:'/meals/batch_create',
              type: 'POST',
              dataType: 'json',
              contentType: 'application/json',
              data: JSON.stringify(dataArr),
               headers: {
                'X-Transaction': 'POST Example',
                'X-CSRF-Token': $('meta[name="csrf-token"]').attr('content')
              },
          //    success handled by the controller
                error: function (jqXHR, textStatus, errorThrown) {
              //     may want to do flash instead
                  alert("could not save this meal");
              }
          });
    });

});

</script>
<div class="row">
  <div class="col-sm-3"></div>
  <div class="col-sm-3"><%= link_to "See Last Week's Meals", meals_path(date_filter: 7) %></div>
</div>